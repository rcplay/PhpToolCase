<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>PhpToolCase: Query Builder Component (PtcQueryBuilder)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="toolcaseedited.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">PhpToolCase
   </div>
   <div id="projectbrief">Api Documentation Version 0.9.2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>User&#160;Guides</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('query_builder.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Query Builder Component (<a class="el" href="class_ptc_query_builder.html">PtcQueryBuilder</a>) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#introduction">Introduction</a></li>
<li class="level1"><a href="#qb_getting_started">Getting Started</a></li>
<li class="level1"><a href="#selecting_data">Selecting Data</a><ul><li class="level2"><a href="#selecting_all_rows">Retrieving Records From A Table</a></li>
<li class="level2"><a href="#qb_selecting_one_row">Retrieving 1 Record From A Table</a></li>
<li class="level2"><a href="#selecting_one_column">Retrieving 1 Column From A Record</a></li>
<li class="level2"><a href="#qb_specify_column">Specifying Columns To Be Selected</a></li>
<li class="level2"><a href="#qb_multiple_tables">Adding Multiple Tables</a></li>
</ul>
</li>
<li class="level1"><a href="#qb_where_operators">Where Operators</a><ul><li class="level2"><a href="#where_or">Where Or</a></li>
<li class="level2"><a href="#where_in">Where In</a></li>
<li class="level2"><a href="#where_between">Where Between</a></li>
<li class="level2"><a href="#complex_where">Using Closures With Where</a></li>
</ul>
</li>
<li class="level1"><a href="#qb_joins">Joins</a><ul><li class="level2"><a href="#simple_join">Simple Join</a></li>
<li class="level2"><a href="#complex_joins">Using Closures With Joins</a></li>
</ul>
</li>
<li class="level1"><a href="#qb_order_group_limit">Group, Order And Limit</a></li>
<li class="level1"><a href="#manipulating_data">Manipulating Data</a><ul><li class="level2"><a href="#qb_insert_data">Insert Recods</a></li>
<li class="level2"><a href="#qb_update_data">Update Records</a></li>
<li class="level2"><a href="#qb_delete_data">Delete Records</a></li>
<li class="level2"><a href="#qb_last_insert_id">Last Inserted Id</a></li>
<li class="level2"><a href="#qb_count_rows">Counting Rows</a></li>
</ul>
</li>
<li class="level1"><a href="#qb_rawStatemet">Raw Statements</a></li>
<li class="level1"><a href="#qb_rawValues">Raw Values</a></li>
<li class="level1"><a href="#qb_preparing_queries">Preparing Queries</a></li>
<li class="level1"><a href="#set_fetch_mode">Setting The Fetch Mode</a></li>
<li class="level1"><a href="#specifying_return">Specifying The Return Type</a></li>
<li class="level1"><a href="#query_event">Observer Events</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<p>The Query Builder component is an excellent tool that will help you create and execute sql queries in a unique fashion way, by taking advantage of the new features that <b>php 5.3</b> has to offer. This tool uses the Pdo library to execute queries, and adds place holders for the values automatically, making the task of running queries a lot safer. The component can also be used to prepare statements and execute them multiple times. All queries can be logged with the <a class="el" href="class_ptc_debug.html">PtcDebug</a> class. This class can also be used with the <a class="el" href="class_ptc_event.html">PtcEvent</a> component to fire the <code>"ptc.query"</code> event, when queries are executed . <br/>
<br/>
 Main Features: </p>
<ul>
<li>
Simple and intuitive sintax for building queries </li>
<li>
Prepared sql statements for multiple execution </li>
<li>
Can handle sql joins in a very simple way </li>
<li>
Uses The <a class="el" href="class_ptc_debug.html">PtcDebug</a> class to log sql queries and execution timing </li>
<li>
Can be used with the <a class="el" href="class_ptc_event.html">PtcEvent</a> component to observe executed queries </li>
<li>
Protects against sql injection by adding place holders </li>
<li>
Can be used with the <a class="el" href="class_ptc_db.html">PtcDb</a> component to handle multiple instances </li>
<li>
Adds backticks to the query automatically </li>
</ul>
<p><br/>
 </p>
<hr/>
 <h1><a class="anchor" id="qb_getting_started"></a>
Getting Started</h1>
<p>The following example shows how we can initialize the Query Builder with Pdo support to execute queries: </p>
<div class="fragment"><div class="line"><span class="comment">// INITIALIZING A PDO OBJECT TO RUN QUERIES WITH THE QUERY BUILDER</span></div>
<div class="line">$pdo_connection =  <span class="stringliteral">&#39;mysql:host=localhost;dbname=some dbname;charset:uft8;&#39;</span>;</div>
<div class="line">$pdo = <span class="keyword">new</span> PDO( $pdo_connection , <span class="stringliteral">&#39;some user&#39;</span> , <span class="stringliteral">&#39;some pass&#39;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// require the class</span></div>
<div class="line">require_once( <span class="stringliteral">&#39;PtcQueryBuilder.php&#39;</span> );    </div>
<div class="line"></div>
<div class="line"><span class="comment">// initializing the query builder with pdo support</span></div>
<div class="line">$qb = <span class="keyword">new</span> <a class="code" href="class_ptc_query_builder.html">PtcQueryBuilder</a>( $pdo );    </div>
<div class="line"></div>
<div class="line"><span class="comment">// retrieve all records from given table</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )-&gt;run( );               </div>
</div><!-- fragment --><p> The class can also be initializited without Pdo support, if you just want to prepare queries and run them some other way. In this case the method <a class="el" href="class_ptc_query_builder.html#a9596f1635d3c078fa06ab0166bcbb11b" title="Builds the query and returns it as string with place holders. ">PtcQueryBuilder::prepare( )</a> should be used: </p>
<div class="fragment"><div class="line"><span class="comment">// including the query builder component</span></div>
<div class="line">require_once( <span class="stringliteral">&#39;PtcQueryBuilder.php&#39;</span> );    </div>
<div class="line"></div>
<div class="line"><span class="comment">// initializing the class</span></div>
<div class="line">$qb = <span class="keyword">new</span> <a class="code" href="class_ptc_query_builder.html">PtcQueryBuilder</a>( );                 </div>
<div class="line"></div>
<div class="line"><span class="comment">// preparing a query</span></div>
<div class="line">$query = $qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;prepare( );      </div>
</div><!-- fragment --><p> <br/>
 </p>
<hr/>
 <h1><a class="anchor" id="selecting_data"></a>
Selecting Data</h1>
<p>The following sections, will demonstrate how to select data with the help of the component: </p>
<h2><a class="anchor" id="selecting_all_rows"></a>
Retrieving Records From A Table</h2>
<p>The method <a class="el" href="class_ptc_query_builder.html#a44914ba367f2fdd0c5f1aeda381e483d" title="Runs queries if pdo object is present. ">PtcQueryBuilder::run( )</a> can be used to retrieve records from a given table: </p>
<div class="fragment"><div class="line"><span class="comment">// retrieve all records</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )-&gt;run( );</div>
<div class="line"></div>
<div class="line"><span class="comment">// retrieve records that match a statement</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;some_field&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span>  )</div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="qb_selecting_one_row"></a>
Retrieving 1 Record From A Table</h2>
<p>Use the method <a class="el" href="class_ptc_query_builder.html#a0077111d66d2ca8eea5df971b83f300a" title="Retrieves 1 row from a given table. ">PtcQueryBuilder::row( )</a> to retrieve 1 single record from a given table: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;some_field&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span> )</div>
<div class="line">  -&gt;row( );</div>
</div><!-- fragment --><p> We can also retrieve 1 single record by id, with the method <a class="el" href="class_ptc_query_builder.html#a79cc82436f3290ec078b1aa19589da20" title="returns 1 record from a given table based on the id. ">PtcQueryBuilder::find( )</a> : </p>
<div class="fragment"><div class="line"><span class="comment">// retrieve record based on id</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )-&gt;find( 2 );</div>
</div><!-- fragment --> <h2><a class="anchor" id="selecting_one_column"></a>
Retrieving 1 Column From A Record</h2>
<p>To retrieve 1 column from a record, specify the <code>"$column"</code> parameter for the <a class="el" href="class_ptc_query_builder.html#a0077111d66d2ca8eea5df971b83f300a" title="Retrieves 1 row from a given table. ">PtcQueryBuilder::row( )</a> method: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;some_field&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span> )</div>
<div class="line">  -&gt;row( <span class="stringliteral">&#39;some_column&#39;</span> );</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>When using the <code>"$column"</code> parameter, any column added with the <a class="el" href="class_ptc_query_builder.html#a9435db0cc4ce79d51ea3950ca734ebba" title="Sets the columns to be selected. ">PtcQueryBuilder::select( )</a> method will be discarded.</dd></dl>
<h2><a class="anchor" id="qb_specify_column"></a>
Specifying Columns To Be Selected</h2>
<p>To specify column names the method <a class="el" href="class_ptc_query_builder.html#a9435db0cc4ce79d51ea3950ca734ebba" title="Sets the columns to be selected. ">PtcQueryBuilder::select( )</a> can be used: </p>
<div class="fragment"><div class="line"><span class="comment">// Specifying 1 column to be selected</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;select( <span class="stringliteral">&#39;some_column&#39;</span> )</div>
<div class="line">  -&gt;run( );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Specifying multiple columns to be selected</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;select( array( <span class="stringliteral">&#39;some_column&#39;</span> , <span class="stringliteral">&#39;some_other_column as i&#39;</span> ) )</div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>If you are aliasing column names, always use <code>"as"</code> otherwise backticks will not be added properly. </dd></dl>
<h2><a class="anchor" id="qb_multiple_tables"></a>
Adding Multiple Tables</h2>
<p>To add multiple tables to the query, use an array with the <a class="el" href="class_ptc_query_builder.html#ac75e84037cdcbeddba0a74fdbcd376d0" title="Adds tables to the query. ">PtcQueryBuilder::table( )</a> method: </p>
<div class="fragment"><div class="line"><span class="comment">// adding multiple tables</span></div>
<div class="line">$qb-&gt;table( array( <span class="stringliteral">&#39;some_table&#39;</span> , <span class="stringliteral">&#39;some_other_table as i&#39;</span> ) )</div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>If you are aliasing table names, always use <code>"as"</code> otherwise backticks will not be added properly.</dd></dl>
<hr/>
 <h1><a class="anchor" id="qb_where_operators"></a>
Where Operators</h1>
<p>Where operators can be added to the query with the <a class="el" href="class_ptc_query_builder.html#a01b97e28c4dc45d93e0bed71383530c6" title="Adds where clouses to the query. ">PtcQueryBuilder::where( )</a> method: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;some_field&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span>  )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;some_other_field&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some other value&#39;</span>  ) <span class="comment">// and</span></div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --><p> All possible options for the <code>"$operator"</code> parameter are stored in the <a class="el" href="class_ptc_query_builder.html#a45ce265abb3226993e0437f6c71d8156" title="Operator for where and join clauses property. ">PtcQueryBuilder::$_operators</a> property: </p>
<div class="fragment"><div class="line">$_operators = array( <span class="charliteral">&#39;=&#39;</span> , <span class="charliteral">&#39;&lt;&#39;</span> , <span class="charliteral">&#39;&gt;&#39;</span> , <span class="stringliteral">&#39;&lt;=&#39;</span> , <span class="stringliteral">&#39;&gt;=&#39;</span> , <span class="stringliteral">&#39;&lt;&gt;&#39;</span> , <span class="stringliteral">&#39;!=&#39;</span> , <span class="stringliteral">&#39;like&#39;</span> , <span class="stringliteral">&#39;not like&#39;</span> , <span class="stringliteral">&#39;between&#39;</span> , <span class="stringliteral">&#39;ilike&#39;</span> );</div>
</div><!-- fragment --><p> The following sections will explain how to use the <a class="el" href="class_ptc_query_builder.html#a01b97e28c4dc45d93e0bed71383530c6" title="Adds where clouses to the query. ">PtcQueryBuilder::where( )</a> method to add where operators in the query. </p>
<h2><a class="anchor" id="where_or"></a>
Where Or</h2>
<p>To add <code>"OR"</code> to the where clause use <code>"or_"</code> like this: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )</div>
<div class="line">    -&gt;where( <span class="stringliteral">&#39;some_field&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span>  )</div>
<div class="line">    -&gt;or_where( <span class="stringliteral">&#39;some_other_field&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some other value&#39;</span>  ) <span class="comment">// or</span></div>
<div class="line">    -&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="where_in"></a>
Where In</h2>
<p>This is how <code>"where in"</code> operators can be added to the query: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">    -&gt;where_in( <span class="stringliteral">&#39;field3&#39;</span> , array( 1 , 2 ) )</div>
<div class="line">    -&gt;or_where_in( <span class="stringliteral">&#39;column&#39;</span> , array( 3 , 4 ) ) <span class="comment">// or in</span></div>
<div class="line">    -&gt;run( );</div>
<div class="line"></div>
<div class="line"><span class="comment">// not in</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">    -&gt;where_not_in( <span class="stringliteral">&#39;column&#39;</span> , array( 3 , 4 ) ) </div>
<div class="line">    -&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="where_between"></a>
Where Between</h2>
<p>Adding a <code>"where between"</code> operator can be achieved this way: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">    -&gt;where_between( <span class="stringliteral">&#39;field3&#39;</span> , <span class="stringliteral">&#39;:value1&#39;</span> , <span class="stringliteral">&#39;:value2&#39;</span> )</div>
<div class="line">    -&gt;or_where_between( <span class="stringliteral">&#39;field3&#39;</span> , <span class="stringliteral">&#39;:value1&#39;</span> , <span class="stringliteral">&#39;:value2&#39;</span> ) <span class="comment">// or between</span></div>
<div class="line">    -&gt;run( );</div>
<div class="line"></div>
<div class="line"><span class="comment">// not between</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )  </div>
<div class="line">    -&gt;where_not_between(  <span class="stringliteral">&#39;field3&#39;</span> , <span class="stringliteral">&#39;:value1&#39;</span> , <span class="stringliteral">&#39;:value2&#39;</span> )</div>
<div class="line">    -&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="complex_where"></a>
Using Closures With Where</h2>
<p>For more complex where operators closures can be used. Take a look at the following example to get an idea of how this works: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">    -&gt;where( <span class="stringliteral">&#39;field1&#39;</span> , <span class="stringliteral">&#39;!=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span> )</div>
<div class="line">    -&gt;where( <span class="keyword">function</span>( $query ) <span class="comment">// will generate AND ( field3 &gt; 10 OR field3 &lt; 100 )</span></div>
<div class="line">    {</div>
<div class="line">        $query-&gt;where( <span class="stringliteral">&#39;field3&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span> , 10 )</div>
<div class="line">            -&gt;or_where( <span class="stringliteral">&#39;field3&#39;</span> , <span class="charliteral">&#39;&lt;&#39;</span> , 100 );</div>
<div class="line">    } )-&gt;run( );</div>
</div><!-- fragment --><p> <br/>
 </p>
<hr/>
 <h1><a class="anchor" id="qb_joins"></a>
Joins</h1>
<p>To create join statements the method <a class="el" href="class_ptc_query_builder.html#accdd3d77409736b775419589d1e59acb" title="Creates a join based on the parameters. ">PtcQueryBuilder::join( )</a> can be used. The following paragraphs will demonstrate how to use this method: </p>
<h2><a class="anchor" id="simple_join"></a>
Simple Join</h2>
<p>Simple joins can be created like shown in the following example: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;join( <span class="stringliteral">&#39;test_table1&#39;</span> , <span class="stringliteral">&#39;test_table.id&#39;</span> , <span class="charliteral">&#39;=&#39;</span> ,  <span class="stringliteral">&#39;test_table1.id&#39;</span> )</div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --><p> To specify the type of join, use <code>"_"</code> uderscore like in the following example: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;left_join( <span class="stringliteral">&#39;test_table1&#39;</span> , <span class="stringliteral">&#39;test_table.id&#39;</span> , <span class="charliteral">&#39;=&#39;</span> ,  <span class="stringliteral">&#39;test_table1.id&#39;</span> ) <span class="comment">// Specifying a left join</span></div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="complex_joins"></a>
Using Closures With Joins</h2>
<p>To create more complex joins, closures with the method <a class="el" href="class_ptc_query_builder.html#a1b18a2e9857956137f5893ec30465618" title="Joins columns based on values. ">PtcQueryBuilder::on( )</a> can be used: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;left_join( <span class="stringliteral">&#39;test_table1&#39;</span> , <span class="keyword">function</span>( $join )</div>
<div class="line">  {</div>
<div class="line">      $join-&gt;on(  <span class="stringliteral">&#39;test_table.id&#39;</span> , <span class="charliteral">&#39;=&#39;</span> ,  <span class="stringliteral">&#39;test_table1.id&#39;</span> )</div>
<div class="line">          -&gt;or_on(  <span class="stringliteral">&#39;test_table.id&#39;</span> , <span class="charliteral">&#39;=&#39;</span> ,  <span class="stringliteral">&#39;test_table1.id&#39;</span> ) <span class="comment">// or on</span></div>
<div class="line">  } )-&gt;run( );</div>
</div><!-- fragment --><p> <br/>
 </p>
<hr/>
 <h1><a class="anchor" id="qb_order_group_limit"></a>
Group, Order And Limit</h1>
<p>To group the query results the method <a class="el" href="class_ptc_query_builder.html#a8c56aed3a9afdb462a6a6a22269d11ac" title="Adds group by to the query. ">PtcQueryBuilder::group( )</a> can be used: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;group( <span class="stringliteral">&#39;some_field&#39;</span> )-&gt;run( );</div>
</div><!-- fragment --><p> To order the query results the method <a class="el" href="class_ptc_query_builder.html#af4349dcb068aff9fd688fcf53c735ae8" title="Adds order to the query. ">PtcQueryBuilder::order( )</a> can be used: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;order( <span class="stringliteral">&#39;some_field&#39;</span> , <span class="stringliteral">&#39;desc&#39;</span> )-&gt;run( );</div>
</div><!-- fragment --><p> To limit results the method <a class="el" href="class_ptc_query_builder.html#a3b689755bffa0d4260f598f62c5c67f7" title="Adds limit to the query. ">PtcQueryBuilder::limit( )</a> can be used: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;limit( 10 )-&gt;run( );</div>
<div class="line"></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;limit( 1 , 100 )-&gt;run( ); <span class="comment">// limit with start and end</span></div>
</div><!-- fragment --><p> <br/>
 </p>
<hr/>
 <h1><a class="anchor" id="manipulating_data"></a>
Manipulating Data</h1>
<p>The following section will demonstrate how data can be manipulated with the query builder class: </p>
<h2><a class="anchor" id="qb_insert_data"></a>
Insert Recods</h2>
<p>To insert new records, the method <a class="el" href="class_ptc_query_builder.html#a0746ee466ee9178068496aa443ed9189" title="Inserts a record in a given table. ">PtcQueryBuilder::insert( )</a> can be used: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table1&#39;</span> )</div>
<div class="line">  -&gt;insert( array( <span class="stringliteral">&#39;field4&#39;</span> =&gt; <span class="stringliteral">&#39;somevalue&#39;</span> ) ) </div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="qb_update_data"></a>
Update Records</h2>
<p>To update records the method <a class="el" href="class_ptc_query_builder.html#a82c086b9d462479161916b27856ad74d" title="Updates records in a given table based on a where clause. ">PtcQueryBuilder::update( )</a> can be used: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">    -&gt;where( <span class="stringliteral">&#39;some_column&#39;</span> , <span class="stringliteral">&#39;!=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span> )</div>
<div class="line">    -&gt;update( array( <span class="stringliteral">&#39;column1&#39;</span> =&gt; <span class="stringliteral">&#39;some value&#39;</span> , <span class="stringliteral">&#39;column2&#39;</span> =&gt; <span class="stringliteral">&#39;some other value&#39;</span> ) )</div>
<div class="line">    -&gt;run( );</div>
</div><!-- fragment --><p> This method also accepts an <code>"id"</code> as second parameter instead of a where operator: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;update( array( <span class="stringliteral">&#39;column1&#39;</span> =&gt; <span class="stringliteral">&#39;some value&#39;</span> , <span class="stringliteral">&#39;column2&#39;</span> =&gt; <span class="stringliteral">&#39;some other value&#39;</span> ) , 2 ) <span class="comment">// update record based on id</span></div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="qb_delete_data"></a>
Delete Records</h2>
<p>To delete records the method <a class="el" href="class_ptc_query_builder.html#a0fa3387249f930dea59b44e92b7235eb" title="Deletes rows from a given table based on a where clause. ">PtcQueryBuilder::delete( )</a> can be used: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">   -&gt;where( <span class="stringliteral">&#39;some_column&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span> )</div>
<div class="line">  -&gt;delete( )</div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --><p> The <code>"$id"</code> parameter can replace the where operator: </p>
<div class="fragment"><div class="line"><span class="comment">// delete record based on id</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;delete( 2 )-&gt;run( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="qb_last_insert_id"></a>
Last Inserted Id</h2>
<p>The method <a class="el" href="class_ptc_query_builder.html#a27993b901efcccbdbb2738ffdec18f16" title="Retrieves last inserted id. ">PtcQueryBuilder::lastId( )</a> can be used to retrieve the last inserted id: </p>
<div class="fragment"><div class="line"><span class="comment">// get the last id</span></div>
<div class="line">$last_insert_id = $qb-&gt;lastId( );</div>
</div><!-- fragment --> <h2><a class="anchor" id="qb_count_rows"></a>
Counting Rows</h2>
<p>The method <a class="el" href="class_ptc_query_builder.html#a8580e0f66cd4e682e4337c88e1c6545c" title="Returns number of affected rows from last query. ">PtcQueryBuilder::countRows( )</a> can be used to see the number of affected rows by the last query: </p>
<div class="fragment"><div class="line"><span class="comment">// deleting some data</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;some_column&#39;</span> , <span class="charliteral">&#39;=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span> )</div>
<div class="line">  -&gt;delete( )</div>
<div class="line">  -&gt;run( );</div>
<div class="line"></div>
<div class="line"><span class="comment">//counting affected rows by previous delete</span></div>
<div class="line">$affected_rows = $qb-&gt;countRows(  );</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The number of affected rows is automatically returned for update,insert and delete quieries.</dd></dl>
<p><br/>
 </p>
<hr/>
 <h1><a class="anchor" id="qb_rawStatemet"></a>
Raw Statements</h1>
<p>Raw statements can also be added if you wish, using the method <a class="el" href="class_ptc_query_builder.html#a35a61d3c4c23ce453dc9c1eedeedf7ee" title="Adds A raw where clause to the query. ">PtcQueryBuilder::rawSelect( )</a>, like in the next example: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;some_table&#39;</span> )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;some_field&#39;</span> , <span class="stringliteral">&#39;!=&#39;</span> , <span class="stringliteral">&#39;some value&#39;</span> )</div>
<div class="line">  -&gt;rawSelect( <span class="stringliteral">&#39; ORDER BY some_field , DESC&#39;</span> ) <span class="comment">// just an example</span></div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --><p> Whatever you add with this method, will be attached to the end of the query, but before you add anything else. </p>
<dl class="section note"><dt>Note</dt><dd>This method does not offer any protection against sql injection, it is adviced to use the <a class="el" href="class_ptc_query_builder.html#a7568f9b715fc80fe8472419fb4c0a5fd" title="Adds a raw value to a where clause in the query. ">PtcQueryBuilder::raw( )</a> method instead.</dd></dl>
<hr/>
 <h1><a class="anchor" id="qb_rawValues"></a>
Raw Values</h1>
<p>To add raw values to the query, use <a class="el" href="class_ptc_query_builder.html#a7568f9b715fc80fe8472419fb4c0a5fd" title="Adds a raw value to a where clause in the query. ">PtcQueryBuilder::raw( )</a> method: </p>
<div class="fragment"><div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )</div>
<div class="line">  -&gt;where( <span class="stringliteral">&#39;field1&#39;</span> , <span class="stringliteral">&#39;!=&#39;</span> , $qb-&gt;raw( <span class="stringliteral">&#39;NOW()&#39;</span> ) )</div>
<div class="line">  -&gt;run( );</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The <a class="el" href="class_ptc_query_builder.html#a7568f9b715fc80fe8472419fb4c0a5fd" title="Adds a raw value to a where clause in the query. ">PtcQueryBuilder::raw( )</a> method can be passed to most of the component methods as argument, but should be used with caution, as it does not prevent against sql injection.</dd></dl>
<hr/>
 <h1><a class="anchor" id="qb_preparing_queries"></a>
Preparing Queries</h1>
<p>The query builder offers the possibility to prepare queries and store the query string in a variable for later usage: </p>
<div class="fragment"><div class="line"><span class="comment">// preparing place holders for an insert</span></div>
<div class="line">$fields = array( <span class="stringliteral">&#39;some_column&#39;</span> =&gt; <span class="stringliteral">&#39;:value1&#39;</span> , <span class="stringliteral">&#39;some_other_column&#39;</span> =&gt; <span class="stringliteral">&#39;:value2&#39;</span> ); </div>
<div class="line"></div>
<div class="line"><span class="comment">// storing the query in a variable for later usage</span></div>
<div class="line">$query = $qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;insert( $fields )-&gt;prepare( );</div>
<div class="line"></div>
<div class="line"><span class="comment">// executing the query multiple times with the run method</span></div>
<div class="line"><span class="keywordflow">for</span> ( $i = 0; $i &lt; 10; $i++ )</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// binding values to the place holders</span></div>
<div class="line">  $fields = array( <span class="stringliteral">&#39;:value1&#39;</span> =&gt; <span class="stringliteral">&#39;some value &#39;</span> . $i , <span class="stringliteral">&#39;:value2&#39;</span> =&gt; <span class="stringliteral">&#39;some other value&#39;</span> . $i );</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// using the &quot;$query&quot; and the &quot;$bind&quot; parameters with the run( ) method</span></div>
<div class="line">  $qb-&gt;run( $query , $fields );</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The <a class="el" href="class_ptc_query_builder.html#a9596f1635d3c078fa06ab0166bcbb11b" title="Builds the query and returns it as string with place holders. ">PtcQueryBuilder::prepare( )</a> method can only be used with <code>"place holders"</code>, refer to the <code>Pdo</code> manual for understanding how <code>"place holders"</code> work.</dd></dl>
<hr/>
 <h1><a class="anchor" id="set_fetch_mode"></a>
Setting The Fetch Mode</h1>
<p>To set the fetch mode of the Pdo object for the current query, use the method <a class="el" href="class_ptc_query_builder.html#a3700cb5caad2165d23b66bd553331721" title="Sets fetch mode for the next query. ">PtcQueryBuilder::setFetchMode( )</a>. </p>
<div class="fragment"><div class="line"><span class="comment">// will set the Pdo fetch mode for the next query</span></div>
<div class="line">$qb-&gt;setFetchMode( PDO::FETCH_ASSOC );</div>
<div class="line"></div>
<div class="line"><span class="comment">// this query will return an array</span></div>
<div class="line">$result = $qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;limit( 10 )-&gt;run( );</div>
</div><!-- fragment --><p> <br/>
 </p>
<hr/>
 <h1><a class="anchor" id="specifying_return"></a>
Specifying The Return Type</h1>
<p>When using the <code>"$query"</code> parameter with the method <a class="el" href="class_ptc_query_builder.html#a44914ba367f2fdd0c5f1aeda381e483d" title="Runs queries if pdo object is present. ">PtcQueryBuilder::run( )</a>, the class tries to guess if the query passed is a select, if so it will return a result. Otherwise it will simply return the number of affected rows. <br/>
<br/>
 To control this behaviour the parameter <code>"$type"</code> can be used: </p>
<div class="fragment"><div class="line"><span class="comment">// force to return a result</span></div>
<div class="line">$db-&gt;run( <span class="stringliteral">&#39;SHOW COLUMNS FROM `some_table`&#39;</span> , <span class="stringliteral">&#39;&#39;</span> ,  1 );</div>
</div><!-- fragment --><p> These are all possible values for the <code>"$type"</code> parameter: </p>
<ul>
<li>
<code>1</code> Returns result if any </li>
<li>
<code>2</code> Returns only 1 row </li>
<li>
<code>3</code> Returns number of affected rows </li>
</ul>
<p><br/>
 </p>
<hr/>
 <h1><a class="anchor" id="query_event"></a>
Observer Events</h1>
<p>This class can be used with the <a class="el" href="class_ptc_event.html">PtcEvent</a> component to fire an event for every executed query: </p>
<div class="fragment"><div class="line"><span class="comment">// require the PtcEvent component</span></div>
<div class="line">require_once( <span class="stringliteral">&#39;PtcEvent.php&#39;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// adding a listener to the &quot;ptc.query&quot; event</span></div>
<div class="line"><a class="code" href="class_ptc_event.html#a0c49b7c1c81ef6da3276ab28592db0d1">PtcEvent::listen</a>( <span class="stringliteral">&#39;ptc.query&#39;</span> , <span class="keyword">function</span>( $result , $query , $bindings )</div>
<div class="line">{ </div>
<div class="line">  <span class="comment">// we can log all queries here</span></div>
<div class="line">} );</div>
<div class="line"></div>
<div class="line"><span class="comment">// running any query will trigger our listener</span></div>
<div class="line">$qb-&gt;table( <span class="stringliteral">&#39;test_table&#39;</span> )-&gt;run( );</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Refer to the <a class="el" href="event_dispatcher.html">Event Dispatcher Component (PtcEvent)</a> user manual, for detailed usage over event listeners.</dd></dl>
<p><br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
 <!-- start footer part -->
	<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
		<ul>
			<li class="navelem"><a class="el" href="index.html">User Guides</a></li>
			<li class="footer">Generated on Sat Dec 7 2013 00:01:10 for PhpToolCase by
				<a href="http://www.doxygen.org/index.html">
				<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 
			</li>
		</ul>
	</div>
	<!-- Start of StatCounter Code for Default Guide -->
	<script type="text/javascript">
	var sc_project=7779914; 
	var sc_invisible=1; 
	var sc_security="4a86be8b"; 
	</script>
	<script type="text/javascript"
	src="http://www.statcounter.com/counter/counter.js"></script>
	<noscript><div class="statcounter"><a title="tumblr page
	counter" href="http://statcounter.com/tumblr/"
	target="_blank"><img class="statcounter"
	src="http://c.statcounter.com/7779914/0/4a86be8b/1/"
	alt="tumblr page counter"></a></div></noscript>
	<!-- End of StatCounter Code for Default Guide -->
</body>
</html>